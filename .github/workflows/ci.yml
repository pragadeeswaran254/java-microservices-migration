name: Customers Service CI Pipeline

on:
  push:
    branches: [ "main" ]
    # Only trigger if changes happen in the customers service or this pipeline
    paths:
      - 'spring-petclinic-customers-service/**'
      - '.github/workflows/ci.yml'

jobs:
  build-and-containerize:
    runs-on: ubuntu-latest # This is the free Microsoft cloud server

    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v3

    - name: â˜• Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: maven

    - name: ğŸ”¨ Compile Java Code (Maven)
      # This compiles the code and creates the target/app.jar file
      run: ./mvnw clean package -pl spring-petclinic-customers-service -am -DskipTests

    - name: ğŸ³ Build Docker Image
      # This uses your Dockerfile to package the .jar into a container
      run: |
        cd spring-petclinic-customers-service
        docker build -t petclinic-customers:latest .